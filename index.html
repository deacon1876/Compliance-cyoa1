<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Compliance Adventure — CYOA</title>
<style>
  :root{ --hdr:56px; }

  /* Base */
  body {
    margin:0;
    background:#0b1020;
    color:#e5e7eb;
    font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial,sans-serif;

    /* (optional) if you meant to scale the whole app */
    transform: scale(0.85);
    transform-origin: top left;
    width: 117.65vw;
    height: 117.65vh;
    overflow: hidden;
  }
  .hidden{display:none}

  /* Header (fixed height for viewport math) */
  header{position:sticky;top:0;background:rgba(2,6,23,.75);backdrop-filter:blur(8px);border-bottom:1px solid rgba(148,163,184,.25);z-index:5}
  .wrap{max-width:1080px;margin:0 auto;padding:0 18px;height:var(--hdr);display:flex;justify-content:space-between;align-items:center}
  .title{font-weight:800}
  .pill{border:1px solid rgba(148,163,184,.35);border-radius:999px;padding:.25rem .7rem;color:#94a3b8}

  /* Screen takes exactly remaining viewport height (no page scroll) */
  .screen{height:calc(100vh - var(--hdr));padding:0}

  /* Side-by-side stage */
  .stage{height:100%;max-width:1400px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:0}

  /* Left panel (text) */
  .pane{height:100%;overflow:auto;background:rgba(17,24,39,.6);border:1px solid #1f2937;border-radius:0 0 0 0;padding:18px}
  /* Give panel nice rounded corners on outer edges for large screens */
  @media (min-width:901px){
    .pane{border-radius:16px 0 0 16px}
    .mediaBox{border-radius:0 16px 16px 0}
  }

  .scene-meta{color:#94a3b8;margin-bottom:6px}
  .choices{display:grid;gap:12px;margin-top:14px}
  button.choice{appearance:none;background:rgba(255,255,255,.06);color:#e5e7eb;padding:14px;border-radius:12px;text-align:left;font-weight:700;cursor:pointer;transition:.15s ease;border:3px solid transparent}
  button.choice:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.25)}

  /* Color cycle for borders */
  .c1{border-color:#60a5fa}      .c1:hover{background:rgba(96,165,250,.12)}
  .c2{border-color:#34d399}      .c2:hover{background:rgba(52,211,153,.12)}
  .c3{border-color:#f59e0b}      .c3:hover{background:rgba(245,158,11,.12)}
  .c4{border-color:#a78bfa}      .c4:hover{background:rgba(167,139,250,.12)}
  .c5{border-color:#fb7185}      .c5:hover{background:rgba(251,113,133,.12)}
  .c6{border-color:#22d3ee}      .c6:hover{background:rgba(34,211,238,.12)}

  /* Right media pane fills height with cover */
  .mediaBox{height:100%;overflow:hidden;background:#0a0f1d;border:1px solid #1f2937}
  .mediaBox img{width:100%;height:100%;object-fit:cover;display:block}

  /* Result / Summary cards use same visual as pane */
  .result,.summary{height:100%;overflow:auto;background:rgba(17,24,39,.6);border:1px solid #1f2937;border-radius:0 0 0 0;padding:18px}
  @media (min-width:901px){
    .result,.summary{border-radius:16px 0 0 16px}
  }
  .good{color:#22c55e;font-weight:800}
  .bad{color:#f87171;font-weight:800}
  .warn{color:#94a3b8;margin:.5rem 0 0 1rem}

  /* Remove bullets on result warnings & summary list */
  #resultWarn, #summaryList { list-style-type:none; padding-left:0; margin-left:0; }

  .nav{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px}
  .btn{background:linear-gradient(90deg,#60a5fa,#3b82f6);color:#fff;border:0;padding:.8rem 1rem;border-radius:10px;font-weight:800;cursor:pointer}
  .ghost{background:transparent;color:#e5e7eb;border:1px solid rgba(148,163,184,.45);padding:.8rem 1rem;border-radius:10px;font-weight:700;cursor:pointer}
  .fullgrid{display:grid;gap:12px}

  /* Unify font size */
  body, h1, h2, h3, h4, h5, h6,
  p, span, div, button, input, select, textarea {
    font-size:18px; line-height:1.6;
  }
  h2{font-size:22px} h3{font-size:20px}

  /* Responsive (mobile): stack vertically but still no page scroll
     - Media takes 45vh, text takes 55vh; each scrolls internally if needed */
  @media (max-width:900px){
    .stage{grid-template-columns:1fr;grid-template-rows:55vh 45vh}
    .mediaBox{grid-row:2/3;border-radius:0}
    .pane,.result,.summary{grid-row:1/2;border-radius:0}

    /* Reduce font size for mobile */
    body, h1, h2, h3, h4, h5, h6,
    p, span, div, button, input, select, textarea {
      font-size:12px;
    }
    h2{font-size:13px}
    h3{font-size:14px}
  }
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="title">컴플라이언스 이벤트</div>
    <div class="pill" id="crumb">플레이어: 플레이어</div>
  </div>
</header>

<!-- Start -->
<section class="screen" id="startScreen">
  <div class="stage">
    <div class="pane" style="padding-top:22px;max-width:800px">
      <h2>시작하기</h2>
      <p>플레이어 이름을 입력하세요. 게임 내내 <span class="pname">플레이어</span>로 표시됩니다.</p>
      <input id="playerNameInput" type="text" placeholder="예: 홍길동 / Alex" style="width:90%;padding:12px 14px;border-radius:10px;border:1px solid rgba(148,163,184,.35);background:#0f172a;color:#e5e7eb;outline:none">
      <div class="nav" style="justify-content:space-between">
        <span style="color:#94a3b8">이름은 나중에 메뉴에서 변경할 수 있습니다.</span>
        <button class="btn" onclick="startGame()">게임 시작</button>
      </div>
    </div>
    <div class="mediaBox"><img src="cover.png" alt="게임 표지"></div>
  </div>
</section>

<!-- Menu -->
<section class="screen hidden" id="menuScreen">
  <div class="stage">
    <div class="pane" style="padding-top:22px;max-width:800px">
      <h2>에피소드 선택</h2>
      <p><span class="pname">플레이어</span>님, 에피소드를 선택하세요.</p>
      <div id="episodeButtons" class="fullgrid"></div>
      <div class="nav" style="justify-content:flex-end"><button class="ghost" onclick="changeName()">플레이어 이름 변경하기</button></div>
    </div>
    <div class="mediaBox"><img src="menu_banner.png" alt="메인 메뉴로 돌아가기"></div>
  </div>
</section>

<!-- Situation -->
<section class="screen hidden" id="situationScreen">
  <div class="stage">
    <div class="pane">
      <div class="scene-meta" id="sceneMeta"></div>
      <h2 id="episodeTitle"></h2>
      <p id="situationText"></p>
      <div id="choices" class="choices"></div>
    </div>
    <div class="mediaBox" id="situationMediaRight"></div>
  </div>
</section>

<!-- Result -->
<section class="screen hidden" id="resultScreen">
  <div class="stage">
    <div class="result">
      <h3 id="resultTitle"></h3>
      <p id="resultText"></p>
      <ul class="warn" id="resultWarn"></ul>
      <div class="nav">
        <button class="ghost" onclick="go('menuScreen')">메인 메뉴로 돌아가기</button>
        <button class="btn" id="nextButton">다음</button>
      </div>
    </div>
    <div class="mediaBox" id="resultMediaRight"></div>
  </div>
</section>

<!-- Episode Summary -->
<section class="screen hidden" id="episodeSummaryScreen">
  <div class="stage">
    <div class="summary">
      <h3 id="summaryTitle">에피소드 요약</h3>
      <p id="summaryIntro"></p>
      <ul id="summaryList" class="warn"></ul>
      <div class="nav">
        <button class="ghost" onclick="go('menuScreen')">메인 메뉴로 돌아가기</button>
        <button class="btn" id="summaryNextButton">다음 에피소드</button>
      </div>
    </div>
    <div class="mediaBox" id="summaryMediaRight"></div>
  </div>
</section>

<script>
  // ---------- State ----------
  let playerName = '플레이어';
  let currentEpisode = 0;
  let currentSituation = 0;

  // ---------- Data ----------
  const episodes = [
    {
      title: "에피소드 1: 업체 선정 과정",
      btn: "에피소드 1 — 시작",
      summaryMedia: "ep1_summary.png",
      lessons: [
        "공개 정보와 평가 기준 외의 영향력 행사는 공정성을 저해합니다.",
        "상사의 비공식 지시에도 절차·기준을 우선해야 합니다.",
        "이해충돌 소지는 선제적으로 공개하고 회피해야 합니다."
      ],
      situations: [
        {
          meta: "에피소드 1 · 상황 1-1",
          media: "situation_ep1_1.png",
          text: "퇴근 무렵 협력업체 담당자가 부탁한다. “이번 입찰에서 꼭 우리 회사가 선정되게 도와주세요, {{name}}님.” 잠시 흔들린다.",
          choices: [
            { text: "공고문에 나온 조건 외에는 영향 줄 수 없다고 설명하며 원칙을 지킨다.", correct: true,
              feedback: { title:"좋은 선택", body:"공정성과 투명성을 우선했습니다.", warn:["비공개 정보를 귀띔해 주거나 특정 업체에 유리한 조언을 해서는 안 됩니다."] } },
            { text: "직접 도와줄 순 없지만, 심사위원들이 좋아할 만한 방향 정도는 귀띔해 준다.", correct: false,
              feedback: { title:"잘못된 선택", body:"사소해 보여도 공정성을 해칠 수 있습니다.", warn:["편파 유도와 공정성 저해를 방지해야 합니다."] } }
          ]
        },
        {
          meta: "에피소드 1 · 상황 1-2",
          media: "situation_ep1_2.png",
          text: "회의 후 상사가 말한다. “이번에는 ○○업체 좀 밀어주자, {{name}}.” 그대로 따를지 고민된다.",
          choices: [
            { text: "평가 기준과 절차를 따르는 게 회사에도 득이 된다고 조심스럽게 의견을 제시한다.", correct: true,
              feedback:{ title:"좋은 선택", body:"절차 준수는 결과 신뢰를 높입니다.", warn:["부당한 지시를 수용하거나 기준·절차에 반하는 개입을 해서는 안 됩니다."]}},
            { text: "일단 상사 뜻을 따르되, 문제가 커지지 않길 바라며 넘어간다.", correct:false,
              feedback:{ title:"잘못된 선택", body:"묵인은 동조로 비칠 수 있습니다.", warn:["부당 특혜와 편파 평가는 있어서는 안 됩니다."]}}
          ]
        },
        {
          meta: "에피소드 1 · 상황 1-3",
          media: "situation_ep1_3.png",
          text: "거래선 선택에 대한 심사를 하게 되었다. 그런데 심사받는 업체 중에 친형 소유의 회사가 보인다. “그런 사실을 굳이 알리지 않아도 되지 않을까, {{name}}?”",
          choices: [
            { text: "나의 이런 이해관계를 회사에 보고한다.", correct: true,
              feedback:{ title:"좋은 선택", body:"이해충돌 우려를 사전에 차단했습니다.", warn:["이해관계를 은폐하거나 편파적으로 판단하면 안 됩니다."]}},
            { text: "나는 관련성이 크지 않다고 여기고 알리지 않고 심사 작업에 참여한다.", correct:false,
              feedback:{ title:"잘못된 선택", body:"사후 적발 시 전체 절차의 신뢰를 무너뜨릴 수 있습니다.", warn:["이해관계 은폐는 기준과 절차에 반하는 결과로 이어질 수 있습니다."]}}
          ]
        }
      ]
    },

    {
      title: "에피소드 2: 선물 및 접대",
      btn: "에피소드 2 — 시작",
      summaryMedia: "ep2_summary.png", 
      lessons: [
        "형식이 아니라 실질 기준으로 ‘접대/향응’을 판단해야 합니다.",
        "작은 선물도 누적·관행화되면 리스크가 급증할 수 있습니다.",
        "수령 전 회사 기준 확인 및 거절 의사를 명확히 해야 합니다."
      ],
      situations: [
        {
          meta: "에피소드 2 · 상황 2-1",
          media: "situation_ep2_1.png",
          text: "“좋은 식당 예약했습니다. 꼭 같이 하시죠.” ‘이 정도는 괜찮지 않나?’라는 생각이 스친다, {{name}}.",
          choices: [
            { text:"회사 규정을 이유로 정중히 거절한다.", correct:true,
              feedback:{title:"좋은 선택", body:"사적 이해 유발 소지를 차단했습니다.", warn:["향응/접대 수수는 피해야 합니다."]}},
            { text:"공식적인 자리로 포장되었으니 참석한다.", correct:false,
              feedback:{title:"잘못된 선택", body:"형식이 공적이어도 실질은 사적 제공일 수 있습니다.", warn:["이해충돌이 유발될 수 있으므로 주의해야 합니다."]}}
          ]
        },
        {
          meta: "에피소드 2 · 상황 2-2",
          media: "situation_ep2_2.png",
          text: "거래처가 고급 포장 상자를 내민다. “작은 정성이에요, {{name}}님.” 거절하면 관계가 나빠질까 걱정된다.",
          choices: [
            { text:"받을 수 없음을 설명하고 돌려보낸다.", correct:true,
              feedback:{title:"좋은 선택", body:"업무 관련 금품 수수의 오해를 차단했습니다.", warn:["선물 수수는 정해진 기준과 절차에 따라야 합니다."]}},
            { text:"일단 받고 나중에 생각한다.", correct:false,
              feedback:{title:"잘못된 선택", body:"‘일단 수수’는 그 자체로 리스크가 됩니다.", warn:["금품 수수는 정해진 기준과 절차에 따라야 합니다."]}}
          ]
        },
        {
          meta: "에피소드 2 · 상황 2-3",
          media: "situation_ep2_3.png",
          text: "동료가 속삭인다. “이 정도는 다 받아.” 선물을 받는 것이 맞는지 고민된다, {{name}}.",
          choices: [
            { text:"작은 것이라도 쌓이면 문제, 원칙을 지킨다.", correct:true,
              feedback:{title:"좋은 선택", body:"관행이라도 기준을 낮추지 않았습니다.", warn:["관행이 규정에 어긋난다면 묵인해서는 안 됩니다."]}},
            { text:"분위기를 깨지 않으려 맞장구친다.", correct:false,
              feedback:{title:"잘못된 선택", body:"침묵·동조가 누적되면 큰 문제가 됩니다.", warn:["묵시적 동조도 동조입니다."]}}
          ]
        }
      ]
    },

    {
      title: "에피소드 3: 직장 내 괴롭힘 대응",
      btn: "에피소드 3 — 시작",
      summaryMedia: "ep3_summary.png", 
      lessons: [
        "모욕·조롱은 즉시 중단을 요청해 2차 피해를 차단해야 합니다.",
        "사적 심부름 등 직무 외 지시는 해서는 안 되며, 거절해야 합니다.",
        "항상 모두를 존중하는 언어의 원칙을 유지해야 합니다."
      ],
      situations: [
        {
          meta: "에피소드 3 · 상황 3-1",
          media: "situation_ep3_1.png",
          text: "선배가 김신입 프로에게 욕설을 퍼붓는다. 모두가 시선을 피한다. {{name}}는 어떻게 할까?",
          choices: [
            { text:"명백한 괴롭힘이므로 제지한다.", correct:true,
              feedback:{title:"좋은 선택", body:"즉시 제지로 피해를 막았습니다.", warn:["인격 모독과 공개 망신은 명백히 괴롭힘입니다."]}},
            { text:"침묵한다.", correct:false,
              feedback:{title:"잘못된 선택", body:"방관은 괴롭힘을 지속시키는 요인이 됩니다.", warn:["방관·묵인해서는 안 됩니다."]}}
          ]
        },
        {
          meta: "에피소드 3 · 상황 3-2",
          media: "situation_ep3_2.png",
          text: "퇴근 후 상사가 반복적으로 개인 심부름을 지시한다. 난감하다, {{name}}.",
          choices: [
            { text:"정중히 업무와 무관함을 말하고 거절한다.", correct:true,
              feedback:{title:"좋은 선택", body:"업무와 무관한 사적인 심부름은 지시해서는 안 됩니다.", warn:["사적 지시는 수용하지 말아야 합니다."]}},
            { text:"그냥 해주며 넘긴다.", correct:false,
              feedback:{title:"잘못된 선택", body:"한 번의 양보가 지속적 요구로 이어질 수 있습니다.", warn:["업무 범위를 벗어나는 일입니다."]}}
          ]
        },
        {
          meta: "에피소드 3 · 상황 3-3",
          media: "situation_ep3_3.png",
          text: "단체 채팅방에서 특정 직원을 조롱하는 글이 이어진다. 불편하다. {{name}}는?",
          choices: [
            { text:"그런 행동을 중단하라고 요구한다.", correct:true,
              feedback:{title:"좋은 선택", body:"직장 내 괴롭힘을 방지했습니다.", warn:["동료에 대한 집단 조롱과 비하 표현을 방치하면 안 됩니다."]}},
            { text:"괜히 나섰다가 불편해질까봐 모른 척한다.", correct:false,
              feedback:{title:"잘못된 선택", body:"침묵은 동조로 비칠 수 있습니다.", warn:["괴롭힘을 보고 침묵하지 마십시오."]}}
          ]
        }
      ]
    },

    {
      title: "에피소드 4: 담합 및 부정청탁",
      btn: "에피소드 4 — 시작",
      summaryMedia: "ep4_summary.png",
      lessons: [
        "직무 관련 금품·향응은 오해와 리스크의 시작입니다.",
        "입찰·제안 관련 정보는 사전 제공이 금지되어 있습니다.",
        "가격 합의 등 경쟁 제한 시도는 즉시 거절해야 합니다."
      ],
      situations: [
        {
          meta: "에피소드 4 · 상황 4-1",
          media: "situation_ep4_1.png",
          text: "업체 담당자가 공연 티켓을 건네며 웃는다. “앞으로도 잘 부탁드립니다, {{name}}님.”",
          choices: [
            { text:"사적인 제공은 받을 수 없다며 정중히 돌려준다.", correct:true,
              feedback:{title:"좋은 선택", body:"사적 이익이 판단에 섞일 여지를 차단했습니다."}},
            { text:"거절하면 관계가 악화될 수 있으니 감사 인사만 하고 티켓을 받는다.", correct:false,
              feedback:{title:"잘못된 선택", body:"직무 관련자에게 받은 금품은 오해와 리스크를 만듭니다."}}
          ]
        },
        {
          meta: "에피소드 4 · 상황 4-2",
          media: "situation_ep4_2.png",
          text: "친분 있는 누군가가 은밀히 말한다. “다음 입찰 때 우리도 도와줄게. 제안서 좀 보여줘, {{name}}.”",
          choices: [
            { text:"공개할 수 없는 정보라며 선을 긋는다.", correct:true,
              feedback:{title:"좋은 선택", body:"불공정 입찰 시도를 차단했습니다.", warn:["내부 자료 유출에 주의해야 합니다."]}},
            { text:"일부라도 보여주면 내 입지에 도움 될까 고민된다.", correct:false,
              feedback:{title:"잘못된 선택", body:"부분 제공이라도 부당한 이익이 될 수 있습니다.", warn:["불공정하게 정보를 제공해서는 안 됩니다."]}}
          ]
        },
        {
          meta: "에피소드 4 · 상황 4-3",
          media: "situation_ep4_3.png",
          text: "동료가 귓속말한다. “업체랑 가격 좀 맞추자. 그래야 다 편하지 않겠어, {{name}}?”",
          choices: [
            { text:"즉시 잘못된 제안이라며 거부한다.", correct:true,
              feedback:{title:"좋은 선택", body:"경쟁 제한 시도를 단호히 차단했습니다.", warn:["경쟁사와의 가격 합의 등 담합은 금지되어 있습니다."]}},
            { text:"다들 한다며 동의한다.", correct:false,
              feedback:{title:"잘못된 선택", body:"담합 행위는 중대한 법 위반이며 회사와 본인 모두에 큰 위험입니다.", warn:["경쟁 제한에 대한 담합은 금지되어 있습니다."]}}
          ]
        }
      ]
    },

    {
      title: "에피소드 5: 정보보호 및 기밀 유지",
      btn: "에피소드 5 — 시작",
      summaryMedia: "ep5_summary.png",
      lessons: [
        "목적 달성 후 불필요한 개인정보는 즉시 파기해야 합니다.",
        "물리 문서·매체를 방치하면 안 되며, 즉시 회수·보관해야 합니다.",
        "내부 정보는 외부 공유가 금지되어 있습니다."
      ],
      situations: [
        {
          meta: "에피소드 5 · 상황 5-1 — 최소 수집",
          media: "situation_ep5_1.png",
          text: "서버 정리를 하다 여러 해 전 저장된 다른 직원의 여권 사본을 발견한다. “보관해도 괜찮을까?” {{name}}는 고민한다.",
          choices: [
            { text:"개인 정보이니 즉시 파기해야 한다.", correct:true,
              feedback:{title:"좋은 선택", body:"개인정보보호법이 허용하지 않은 개인정보는 파기하는 것이 원칙입니다.", warn:["개인정보보호법 위반에 주의해야 합니다."]}},
            { text:"나중에 쓸 수도 있으니 그냥 둔다.", correct:false,
              feedback:{title:"잘못된 선택", body:"불필요한 개인정보의 보유는 개인정보보호법 위반이며, 유출·오남용의 출발점이 되기 쉽습니다.", warn:["개인정보보호법 위반에 주의해야 합니다."]}}
          ]
        },
        {
          meta: "에피소드 5 · 상황 5-2 — 안전 관리",
          media: "situation_ep5_2.png",
          text: "급히 나가다 대외비 정보가 포함된 문서를 회의실에 두고 나왔다. 외부인에게 노출될 수도 있다, {{name}}.",
          choices: [
            { text:"즉시 회수하여 안전하게 보관한다.", correct:true,
              feedback:{title:"좋은 선택", body:"물리적 접근 차단이 가장 기본적인 보호 조치입니다.", warn:["문서를 방치하면 무단 열람될지도 모릅니다."]}},
            { text:"시간이 아까워 그냥 둔다.", correct:false,
              feedback:{title:"잘못된 선택", body:"짧은 방치도 유출·오해로 이어질 수 있습니다.", warn:["문서 관리에 소홀하면 안 됩니다."]}}
          ]
        },
        {
          meta: "에피소드 5 · 상황 5-3 — 목적 외 이용 금지",
          media: "situation_ep5_3.png",
          text: "친한 회사 밖 친구가 부탁한다. “회사 정보 좀 알려줄 수 있지? 경쟁사에서 정말 필요해.”, {{name}}.",
          choices: [
            { text:"내부 정보는 불가, 공개 정보만 언급하거나 정중히 거절한다.", correct:true,
              feedback:{title:"좋은 선택", body:"정보주체와 회사를 함께 보호했습니다.", warn:["내부 정보의 외부 제공이나 목적 외 이용은 금지되어 있습니다."]}},
            { text:"비밀을 지킨다는 조건으로 내부 정보를 알려준다.", correct:false,
              feedback:{title:"잘못된 선택", body:"조건부라도 유출은 유출입니다.", warn:["기밀 유출은 반드시 방지해야 합니다."]}}
          ]
        }
      ]
    }
  ];

  // ---------- Helpers ----------
  const $ = sel => document.querySelector(sel);
  function go(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
    $('#'+id).classList.remove('hidden');
    window.scrollTo({top:0,behavior:'instant'});
    renderNames();
  }
  function renderNames(){
    document.querySelectorAll('.pname').forEach(el=>el.textContent=playerName);
    $('#crumb').textContent = `플레이어: ${playerName}`;
  }
  function startGame(){
    const v = ($('#playerNameInput').value||'').trim();
    playerName = v || '플레이어';
    buildEpisodeButtons();
    go('menuScreen');
  }
  function changeName(){
    const v = prompt('새 플레이어 이름을 입력하세요', playerName);
    if (v!==null){
      const nv = v.trim();
      if (nv) playerName = nv;
      renderNames();
    }
  }
  function buildEpisodeButtons(){
    const box = $('#episodeButtons');
    box.innerHTML = '';
    episodes.forEach((ep, i) => {
      const b = document.createElement('button');
      b.className = 'ghost';
      b.textContent = ep.title;
      b.onclick = () => startEpisode(i);
      box.appendChild(b);
    });
  }

  // media renderer: right-side container per screen (images only)
  function renderMediaInto(sel, src, alt){
    const box = $(sel);
    box.innerHTML = '';
    if (!src) return;
    const img = document.createElement('img');
    img.src = src; img.alt = alt || '이미지';
    box.appendChild(img);
  }

  // Choice color cycling
  const colorClasses = ['c1','c2','c3','c4','c5','c6'];

  function startEpisode(epIndex){
    currentEpisode = epIndex;
    currentSituation = 0;
    showSituation();
  }

  function showSituation(){
    const ep = episodes[currentEpisode];
    const sit = ep.situations[currentSituation];

    go('situationScreen');

    // media (right)
    renderMediaInto('#situationMediaRight', sit.media, sit.meta);

    // meta & text (left)
    $('#sceneMeta').textContent = sit.meta || '';
    $('#episodeTitle').textContent = ep.title + ' — 상황 ' + (currentSituation+1);
    $('#situationText').textContent = (sit.text||'').replaceAll('{{name}}', playerName);

    // choices randomized with colored borders
    const shuffled = [...sit.choices].sort(()=>Math.random()-0.5);
    const bowl = $('#choices'); bowl.innerHTML = '';
    shuffled.forEach((choice, idx) => {
      const btn = document.createElement('button');
      btn.className = 'choice ' + colorClasses[idx % colorClasses.length];
      btn.textContent = choice.text;
      btn.onclick = () => showResult(choice);
      bowl.appendChild(btn);
    });
  }

  function showResult(choice){
    go('resultScreen');

    const good = !!choice.correct;
    $('#resultTitle').className = good ? 'good' : 'bad';
    $('#resultTitle').textContent = choice.feedback?.title || (good ? '좋은 선택' : '잘못된 선택');
    $('#resultText').textContent = choice.feedback?.body || (good ? '바람직한 판단입니다.' : '다시 생각해 보세요.');

    // result media (images only)
    const GOOD_MEDIA = ["good_choice.png","good_choice_alt1.png","good_choice_alt2.png"];
    const BAD_MEDIA  = ["bad_choice.png","bad_choice_alt1.png","bad_choice_alt2.png"];
    const pick = arr => arr[Math.floor(Math.random() * arr.length)];
    const resultSrc = choice.resultMedia || (good ? pick(GOOD_MEDIA) : pick(BAD_MEDIA));
    renderMediaInto('#resultMediaRight', resultSrc, good ? '좋은 선택' : '나쁜 선택');

    // warnings
    const warn = choice.feedback?.warn || [];
    const ul = $('#resultWarn'); ul.innerHTML = '';
    warn.forEach(w => { const li=document.createElement('li'); li.textContent=w; ul.appendChild(li); });

    // next button behavior
    const ep = episodes[currentEpisode];
    const nextBtn = $('#nextButton');
    nextBtn.onclick = () => {
      if (currentSituation < ep.situations.length - 1){
        currentSituation++; showSituation();
      } else {
        showEpisodeSummary();
      }
    };
    nextBtn.textContent = (currentSituation < ep.situations.length - 1) ? '이 에피소드 다음 상황으로' : '에피소드 요약 보기';
  }

  function showEpisodeSummary(){
    const ep = episodes[currentEpisode];
    go('episodeSummaryScreen');

    // Prefer ep.summaryMedia; fallback to last situation image
    const lastMedia = ep.situations[ep.situations.length - 1]?.media || '';
    const sumMedia = ep.summaryMedia || lastMedia;
    renderMediaInto('#summaryMediaRight', sumMedia, ep.title + ' 요약');

    // Text
    $('#summaryTitle').textContent = ep.title + ' — 요약';
    $('#summaryIntro').textContent = `${playerName}님, 이번 에피소드에서 기억할 점입니다:`;

    const ul = $('#summaryList'); ul.innerHTML = '';
    (ep.lessons || []).forEach(item => {
      const li = document.createElement('li'); li.textContent = '' + item; ul.appendChild(li);
    });

    const btn = $('#summaryNextButton');
    if (currentEpisode < episodes.length - 1){
      btn.textContent = '다음 에피소드';
      btn.onclick = () => { currentEpisode++; currentSituation = 0; showSituation(); };
    } else {
      btn.textContent = '마지막 에피소드 완료';
      btn.onclick = () => go('menuScreen');
    }
  }

  // Build menu on load
  (function init(){ renderNames(); buildEpisodeButtons(); })();
</script>
</body>
</html>
